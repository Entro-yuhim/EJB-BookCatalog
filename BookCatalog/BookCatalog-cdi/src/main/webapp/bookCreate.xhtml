<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:rich="http://richfaces.org/rich"
                xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:a4j="http://richfaces.org/a4j"
                template="WEB-INF/templates/default.xhtml">
    <ui:define name="page-body">
        <h:form>
            <h:panelGrid columns="3" columnClasses="titleCell">
                <h:outputLabel for="title" value="Enter title:"/>
                <h:inputText id="title" value="#{bookCreateController.book.title}"/>
                <h:message for="title" errorClass="invalid"/>

                <h:outputLabel for="published" value="Published"/>
                <rich:calendar id="published" value="#{bookCreateController.book.yearPublished}"/>
                <h:message for="published" errorClass="invalid"/>

                <h:outputLabel for="publisher" value="Publisher"/>
                <h:inputText id="publisher" value="#{bookCreateController.book.publisher}"/>
                <h:message for="publisher" errorClass="invalid"/>

                <h:outputLabel for="isbn" value="ISBN"/>
                <h:inputText id="isbn" value="#{bookCreateController.book.iSBN}">
                    <f:validateLength maximum="14"/>
                    <f:validateRequired/>
                </h:inputText>
                <h:message for="isbn" errorClass="invalid"/>
            </h:panelGrid>
            <a4j:outputPanel id="authors">
                <h:dataTable value="#{bookCreateController.authors}" var="author">
                    <h:column>
                        #{author.firstName}
                    </h:column>
                    <h:column>
                        #{author.lastName}
                    </h:column>
                    <h:column>
                        #{author.rating}
                    </h:column>
                </h:dataTable>
            </a4j:outputPanel>
            <h:commandButton action="#{bookCreateController.save}" value="Save"/>
        </h:form>
        <h:form>
            <rich:select id="authorName"
                         mode="cachedAjax" minChars="1"
                         autocomplete="true"
                         autocompleteMethod="#{bookCreateController.autocomplete}"
                         var='author' itemValue="${author.id}"
                         itemLabel="#{author.firstName} #{author.lastName}"
                         value="#{bookCreateController.selectedAuthor}"/>
        </h:form>
        <h:form>
            <h:inputHidden id="selectedAuthor" value="#{bookCreateController.selectedAuthor}"/>
            <a4j:commandButton value="Add" render="authors" execute="@form" onclick="passSelectToAjax()"
                               action="#{bookCreateController.addSelectedAuthor}"/>
        </h:form>
        <h:outputScript>
            function passSelectToAjax() {
                $('[id*=selectedAuthor]').val($("[id*=authorNameInput]").val());
            }
        </h:outputScript>
    </ui:define>
</ui:composition>